{% extends "education_layout.html" %}
{% load static %}

{% block pagedescription %}
{# one liner . <a href="https://xwiki.vo.elte.hu/en/kooplex-manual/educaion"><span class="ms-2 bi bi-book"></span></a>#}
{% endblock %}

{# the search bar #}
{% block search %}
{% if coursebindinglist %}
<div class="card border border-light border-3 mx-5 mb-3 rounded-3">
  <div class="input-group">
    <span class="input-group-text"><span class="bi bi-search"></span></span>
    <input class="form-control" type="text" id="search_course" placeholder="Search course" title="Type in a name" autofocus >
  </div>
</div>
{% endif %}
{% endblock %}


{# render the course cards #}
{% block bodycontent %}
{% if coursebindinglist %}
  <div class="row row-cols-1 row-cols-md-2">
    {% for ucb in coursebindinglist %}
      <div class="col" id="hideable-course-{{ ucb.course.id }}">
        {% include 'course_partial_list.html' with course=ucb.course %}
      </div>
    {% endfor %}
  </div>
{% else %}
  {% include 'empty.html' with empty_title="You are not associated with any courses yet" empty_body="If this is unexpected, please ask system administrators to take care of it. <a href='mailto:kooplex@elte.hu'><i class='bi bi-envelope'></i><span>&nbsp;Send e-mail...</span></a>" %}
{% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>  
{# when course name is clicked open info #}
$("div[id^=course-name-]").click(function() {
  //console.log( this );
  var cid = $( this ).attr("id").split("-", 3)[2];
  $("#courseInfoModal-" + cid).modal('show');
});

{# when hovering course name is change pointer type #}
$("div[id^=course-name-]").mouseenter(function() {
  $( this ).css("cursor", "pointer");
});


{# FIXME: code repetition see project #}
containerSocket = open_ws('{{ wss_container }}', ws_callback_container);

{# handle websocket callback #}
function ws_callback_container(data) {
  console.log(data);
  containerid = data['container-id'];
  if ('w_startopen' in data) {
    $("#container-startopen-" + containerid).replaceWith(data['w_startopen'])
  }
};

{# open a container #} //FIXME: repetition
function open_container(containerid) {
  var url = $( "#url-containeropen-" + containerid).val();
  console.log( "opening: " + url );
  var win = window.open(url, '_blank');
  if (win) {
    win.focus();
  }
}

{# start/open a container #}
function handle_click(w) { // FIXME: code repetition
  containerid = $(w).attr('id').split('-')[2];
  command = $(w).children("input[name=target]").val();
  if (command == "open") {
    open_container(containerid);
    return;
  }
  if (containerSocket.readyState != 1) {
    console.log("Socket not open: " + containerSocket.readyState);
    containerSocket = open_ws('{{ wss_container }}', ws_callback);
  }
  console.log( command + ": " + containerid );
  containerSocket.send(JSON.stringify({
    'command': command,
    'container-id': containerid,
  }));
}
</script>
{% endblock %}

