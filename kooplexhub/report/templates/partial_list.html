{% load report_buttons %}
{% load thumbnail %}
{% load container_buttons %}

<style>
  @media all and (max-width: 728.01px) {
    .imagesize{
width: 200px;
height: 200px;
}

  }

  .goflex{
  display: flex;
}

.border-2 .border-warning{
 display:none;
}

.bg-transparent:hover .border-2 .border-warning {
 opacity: 1;
}

</style>

{# FIXME: resize card #}
<div class="card mb-3 mx-1 border-0 bg-transparent" style="max-width: 560px;">
  {# hidden fields are helpers to shide/show cards accordign to filtering criteria #}
  <input type="hidden" id="report-search-{{report.id}}" value="{{ report.search }}"/>
  <input type="hidden" id="report-match-{{ report.id }}" value="true">
  <input type="hidden" id="report-isshown-{{ report.id }}" value="true">
  {% if user == report.creator %}
    <input type="hidden" id="report-iscreator-{{ report.id }}" value="true">
  {% else %}
    <input type="hidden" id="report-iscreator-{{ report.id }}" value="false">
  {%endif %}
  <div class="row g-0">
    <div class="col-md-11" id="click-report-{{ report.id }}">
      <input type="hidden" id="url-reportopen-{{ report.id }}" value="{% url 'report:open' report.id %}">
      <div class="card-body p-0 border-0">
        <div class="card text-dark bg-secondary m-0 border-2 everything border-warning">
          <div class="card-header text-light fw-bold">{{ report.name }}</div>
          <div class="card-footer bg-light">

            <div class="card w-100 border-0" style="height: 200px">
              <div class="goflex">
                <div class="col-md-5">
                  {% if report.thumbnail|length %}
                    <img src="data:image/png;base64,{{report.thumbnail|decode}}" class="img-fluid imagesize rounded" alt="thumbnail"> {# FIXME: truncate if too large an image #}
		  {% else %}
                    <img src="/static/noimageavailable.png" class="img-fluid rounded imagesize" alt="no thumbnail">
		  {% endif %}
                </div>
                <div class="col-md-7">
                  <div class="card-body">
                    <h5 class="card-title">
                      {% if report.image %}
                        <span class="card-text">{% container_image report.image %}</span>
                      {% else %}
                        <span class="card-text">Static html report</span>
                      {% endif %}
                    </h5>
		    <p class="card-text">{{ report.description|truncatechars:45 }}</p>
		    <p class="card-text"><small class="text-muted"><strong>Creator:</strong> {{ report.creator.profile.name }}</small></p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    {# the sideways button bar is only visible if the mouse is over the card #}
    <div class="col-md-1 ps-1 pt-1 d-none" id="buttonbar-{{ report.id }}">
      {% button_side_modal_open report class_extra="mb-1" %}
      <button data-bs-toggle="modal"  data-bs-target="#reportInfoModal-{{ report.id }}" role="button" class="btn btn-warning btn-sm mb-1" ><span class="bi bi-info-square" aria-hidden="true" data-toggle="tooltip" title="Click for more info" data-placement="top" ></span></button>
      {% button_report_conf report user class_extra="mb-1" %}
      {% button_report_delete report user %}
    </div>
  </div>
</div>


<div class="modal fade" id="reportInfoModal-{{ report.id }}" tabindex="-1" aria-labelledby="reportInfoModal-{{ report.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ report.name }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if report.thumbnail|length %}
        {% image_report_open report %}
	<img src="data:image/png;base64,{{report.thumbnail|decode}}" class="img-fluid mt-2 mb-1">
        {% else %}
	<img class="mt-2 mb-1" src="/static/noimageavailable.png" alt="no thumbnail">
        {% endif %}
        {% if report.image %}
        <span class="card-text mt-2 mb-2"><strong>Image:</strong>&nbsp;{% container_image report.image %}</span>
      {% else %}
        <span class="card-text mt-2 mb-2"><strong>Static html report</strong></span>
      {% endif %}
        <p class="card-text mt-1"><strong>Project:</strong>&nbsp;{{ report.project }}</p>
        <p class="card-text"><strong>Description:</strong>&nbsp;{{ report.description }}</p>
          {% if report.creator == user %}
      <p class="card-text"><strong>Source folder:</strong> {{ report.project.subpath }}/{{ report.folder }}</p>
    {% else %}
      <p class="card-text"><strong>Creator:</strong> {{ report.creator.profile.name}}</p>
    {% endif %}
      </div>
      <div class="modal-footer">
        {% button_report_modal_open report %}
      </div>
    </div>
  </div>
</div>

