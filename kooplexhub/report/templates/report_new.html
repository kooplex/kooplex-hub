{# FIXME: refactor me #}
{% extends "report_layout.html" %}

{% load static %}
{% load extras %}


{% block head_content %}
  <link rel="stylesheet" href="/static/css/tagsinput.css" />
{% endblock %}

{% block bodycontent %}



{% comment %}
<script src="/static/js/tagsinput.js"></script>
    <script>
    $("#post-form").submit(function(e){
        e.preventDefault();
});</script>
{% endcomment %}


    {# https://codepen.io/lekoalabe/pen/ExWYEqx #}
<script type="module">
    import Tags from "https://cdn.jsdelivr.net/gh/lekoala/bootstrap5-tags@master/tags.js";
    Tags.init("select.mytag", {'baseClass': 'mytag'});
</script>

<div class="card shadow mt-3 p-3 mb-2 bg-light rounded">
  {% if f_project|length > 0 %}

  <form id="report-new" class="form-horizontal was-validated dropzone mt-3" action="{% url 'report:create' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
  <div>
    {% title "Set the details of your new report" %}

    <div class="container-fluid d-flex flex-column flex-md-row">
      <div class="d-flex w-100 w-md-75">
        <table>
          <thead>
            <tr>
              <div class="d-flex">
              <th><label class="mt-2" for="project_selected">Project: </label></th>
              </div>
              <td>
                <select id="project_selected" name="project_selected" class="form-select" style="width: 100%">
                  {% for f in f_project %}
                    <option value="{{ f.project.id }}">{{ f.project }}</option>
                  {% endfor %}
                </select>
              </td>
            </tr>
          </thead>
          {% for f in f_project %}
            <tbody style="display: none" id="newReportForm-{{ f.project.id }}">
                {{ f.as_table }}
            </tbody>
          {% endfor %}
        </table>
      </div>
      <div class="d-flex ms-3 w-100 w-md-50">
        <div ata-toggle="tooltip" title="Please select an option from the image dropdown to check its description."  class="d-flex bg-warning rounded p-2 w-100 mt-2 mt-md-0">
          <p class="fw-bolder">Image description:&nbsp;</p>
	  <p id="imageDescription"></p>
	</div>
      </div>
      {{ form.descriptions }}
    </div>
    <div class="d-flex mt-2">
      <h6 style="font-weight: bold;">Report image:</h6> <input class="ms-5" type="file" name="file" />
    </div>
    {% apply_cancel hide_cancel=True label_apply='Create' icon_apply='bi bi-person-workspace' %}
  </div>
  </form>
 {% else %}
     {% include 'empty.html' with  skip_border=True %}
 {% endif %}

</div>




{% endblock %}

{% block scripts %}
<script>
$("#project_selected").change(function () {
    sel = $( this ).val();
  console.log( sel + " - Show "  );
  $('[id^=newReportForm-]').each(function() {
    var myid = $(this).attr("id").split('-')[1]
    console.log( "checking " + myid );
  if (sel != myid) {
    $( "#newReportForm-" + myid ).hide();
    $( "#newReportForm-" + myid ).find('input').each(function() {
      $( this ).prop( "disabled", true );
    });
    $( "#newReportForm-" + myid ).find('textarea').each(function() {
      $( this ).prop( "disabled", true );
    });
    $( "#newReportForm-" + myid ).find('select').each(function() {
      $( this ).prop( "disabled", true );
    });
  }
	  else {
  $( "#newReportForm-" + sel ).show();
  $( "#newReportForm-" + sel ).find('input').each(function() {
    $( this ).prop( "disabled", false );
  });
  $( "#newReportForm-" + sel ).find('textarea').each(function() {
    $( this ).prop( "disabled", false );
  });
  $( "#newReportForm-" + sel ).find('select').each(function() {
    $( this ).prop( "disabled", false );
  });
	  }
  });
}).change();
//$("#project_selected").change(function () {
//  var old = $( "#project_id" ).val();
//  var sel;
//  $( "#project_selected>option:selected" ).each(function() {
//    sel = $( this ).val();
//    $( "#project_id" ).val( sel );
//  });
//    console.log( sel + "Hide " + old );
//  if (sel != old) {
//    console.log( "Hide " + $("#newReportForm-" + old ) );
//    $( "#newReportForm-" + old ).hide();
//    $( "#newReportForm-" + old ).find('input').each(function() {
//      $( this ).prop( "disabled", true );
//    });
//    $( "#newReportForm-" + old ).find('textarea').each(function() {
//      $( this ).prop( "disabled", true );
//    });
//    $( "#newReportForm-" + old ).find('select').each(function() {
//      $( this ).prop( "disabled", true );
//    });
//  }
////	else {
////    $('[id^=newReportForm-]').each(function() {
////      $( this ).find('input').each(function() {
////        $( this ).prop( "disabled", true );
////      });
////      $( this ).find('textarea').each(function() {
////        $( this ).prop( "disabled", true );
////      });
////      $( this ).find('select').each(function() {
////        $( this ).prop( "disabled", true );
////      });
////    });
////  }
//  $( "#newReportForm-" + sel ).show();
//  $( "#newReportForm-" + sel ).find('input').each(function() {
//    $( this ).prop( "disabled", false );
//  });
//  $( "#newReportForm-" + sel ).find('textarea').each(function() {
//    $( this ).prop( "disabled", false );
//  });
//  $( "#newReportForm-" + sel ).find('select').each(function() {
//    $( this ).prop( "disabled", false );
//  });
//  console.log( "chg: " + old + " -> " + sel );
//}).change();
</script>
{% endblock %}
